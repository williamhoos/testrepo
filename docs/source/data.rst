.. _Data perspective:

================
Data perspective 
================

As indicated in the :ref:`Overview` discussion respecting :ref:`Data`, this section describes how PEER presently handles data from the point that it is initially entered into the system by a user, proxy or administrator, to the point that that data is either viewable onscreen or appears in an exported file or document, or is taken into account in any calculation of reported results. 

Where not self-descriptive, this section includes an explanation of each function and/or subroutine thatâ€™s involved in this process, including its range of input and output values, any associated program variables and constants, and an explanation for how these are used by the application in handling or manipulating data; and 


.. _Architecture

Achitecture
***********

The following illustration summarizes the overall architecture of the system with respect to data in/data out, including links to which pages, views or fields of the system are used to introduce data elements and the respective flow, transformation and/or retention of such data through the point that the data is consumed (*i.e.*, used by the system, viewed, exported or discarded) according to explicit rules.

.. image:: TBD 
     :alt: Overall system architecture from the perspective of data it contains
|

.. _Existing user verification

PEER survey data
****************

Each of the PEER staging, beta and production environments contains a database entitled "**peer_surveys_published**".  This database is generally the same in all three environments, although the table structures and fields contained inside certain tables may be slightly different depending on development work that is taking place at the time, and the progress of migrating that work from staging into the beta, and production environments.  

Survey data that is collected through PEER is stored in a table entitled "**Data**", which as of October 2016, contains participant responses to all PEER questions, and comprises approximately 106.5 MB in beta, and ___ MB in production.  The Data table uses the **InnoDB engine**, whose strength is its ability to supports transactional queries and concurrency; and **utf8_general_ci** character set as its default character set for storing data into the database.  An image of the Data table is shown below:

.. image:: https://s3.amazonaws.com/peer-downloads/images/TechDocs/PEER+survey+data+table.png
     :alt: PEER survey data table    
     
This table in PEER is generated by the following SQL instruction::

 CREATE TABLE `data` (
 `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
 `survey_id` BIGINT(20) UNSIGNED NOT NULL DEFAULT '0',
 `session_id` BIGINT(32) UNSIGNED NOT NULL DEFAULT '0',
 `date_added` DATETIME NULL DEFAULT NULL,
 `widget_id` VARCHAR(50) NULL DEFAULT NULL,
 `user_id` BIGINT(20) NULL DEFAULT NULL,
 `variable_date` DATE NULL DEFAULT NULL,
 `question_id` BIGINT(20) UNSIGNED NULL DEFAULT NULL,
 `variable_value` VARCHAR(2000) NULL DEFAULT NULL,
 `response_value` VARCHAR(2000) NULL DEFAULT NULL,
 `unit_of_measure` BIGINT(20) UNSIGNED NULL DEFAULT NULL,
 `group_id` BIGINT(20) UNSIGNED NULL DEFAULT NULL,
 `segment_id` INT(11) NOT NULL,
 `skipped` TINYINT(2) UNSIGNED NULL DEFAULT '0',
 `is_dynamic` TINYINT(3) UNSIGNED NULL DEFAULT '0',
 `instance_id` INT(11) NOT NULL,
 `dynamic_question_id` INT(11) NOT NULL,
 `proxy_user_id` INT(11) NOT NULL,
 PRIMARY KEY (`id`),
 INDEX `Index 2` (`survey_id`, `session_id`, `group_id`, `question_id`, `widget_id`, `user_id`, `date_added`, `variable_date`)
 )
 COLLATE='utf8_general_ci'
 ENGINE=InnoDB
 AUTO_INCREMENT=2042996
 ;

As indicated, the table contains a total of 18 columns, each of which is briefly described below:  

#.  The **id** column is auto-incremented, and contains an integer of up to 20 characters.  In operation, the mySQL server assigns a unique ID value automatically whenever a new record is inserted into the database.  As of October 2016, there are over 2 million records that have been entered into the beta database, and ____ million records in the production database. 

The gold key shown to the left of the number column indicates that the value functions as the Primary Key for the database index, and each of the green keys indicates that the values in that column are also indexed and the results cached to make it more efficient to queries that may be submitted.

Other properties include the "**Unsigned**" column, which when checked indicates that the data field can only contain positive numerical values, and when unchecked indicates that it can contain negative numerical values; the "**Allow Null**" column, which when checked indicates that the data fieled is permitted to contain a null value, and when unchecked requires that some value be stored in the field and not be empty; the "**Zerofill**" propery is not being used.  The "**Default**" column indicates the value the SQL server will use when data is entered into the table that does not designate another value for that field.

#.  The **survey_id** designates the survey to which the answer pertains. 

#.  The **session_id** indicates the session the user was in when the answer was provided.

* 4.  The **date_added** indicates the date and time when the question was answered.

* 5.  The **widget_id** indicates the portal the user was employing when the answer was entered.

* 6.  The **user_id** indicates the participant profile that provided the answer.

* 7.  The **variable_date** indicates the data when a question was answered, but which excludes the time of the answer.  This data was used in an earlier release of PEER but is not presentely being used.

* 8.  The **question_id** indicates the question that was being answered, and is recorded as a zero (0) for an introduction or conclusion, where no question was posed although the survey presented information.

* 9.  The **variable_value** indicates 

*10.  The **response_value** indicates

*11.  The **unit_of_measure** indicates

*12.  The **group_id** indicates the instrument in PEER

*13.  The **segment_id** indicates the topic in PEER.

*14.  The **skipped** column records when the user clicked on the "skip" button rather than respond to a question

*15.  The **is_dynamic** flag is 

*16.  The **instance_id**

*17.  The **dynamic_question_id** is used to 

*18.  The **proxy_user_id** indicates 



Slider question anomaly... reported in Pivotal Tracker as *https://www.pivotaltracker.com/story/show/131929961*
